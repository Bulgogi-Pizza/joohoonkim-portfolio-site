version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "Setting up environment variables..."
        - |
          if [ -z "$API_URL" ]; then
            export API_URL="https://api.joohoonkim.site"
            echo "Set API_URL to default: $API_URL"
          fi
        - |
          if [ -z "$NEXT_PUBLIC_API_URL" ]; then
            export NEXT_PUBLIC_API_URL="https://api.joohoonkim.site"
            echo "Set NEXT_PUBLIC_API_URL to default: $NEXT_PUBLIC_API_URL"
          fi
        - echo "API_URL=$API_URL"
        - echo "NEXT_PUBLIC_API_URL=$NEXT_PUBLIC_API_URL"
    build:
      commands:
        - npm run build
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - .next/cache/**/*
      - .npm/**/*
      - node_modules/**/*